= SPGateway Troubleshooting Guide
:page-layout: post
:page-tag: featured
:page-category: Troubleshooting

== How to Use This Troubleshooting Guide

Below is the standard format for describing and troubleshooting the common errors that can occur in the SPGateway. We will use this format to guide you through each problem that might arise when using this product.

Error/Symptom/Status Code::

This section describes ways to identify, diagnose, and resolve the issue named in the title.

Possible Cause:: Possible reason(s) the error is occurring.
Log Statement:: SPGateway Log that can further verify the issue's cause in the application backend.
+
----
Log Statement example
----
Fix/Validation Steps:: Steps that can validate and resolve the problem currently affecting the SPGateway.
. Example step one.
. Example step two, and so on.

== What You Need to Know Before You Start Troubleshooting

To properly troubleshoot the SPGateway, you must meet the following prerequisites:

* Administrator access to the IDP Client.
* Access to the SPGateway Management Console.
* Knowledge of how to retrieve and monitor logs from network appliances, application servers, etc.
* Knowledge of how to identify an HTTP status code that appears in a log statement.

== What Problem Are You Experiencing?

Compare the error you've received with this list, and click the appropriate problem description below:

* <<How to Monitor Logs>>
* <<Tracking ID>>
* <<HTTP Status Codes>>
** <<How Do I Find My Status Code>>
** <<Status Code 400>>
** <<Status Code 403>>
** <<Status Code 404>>
** <<Status Code 405>>
** <<Status Code 413>>
** <<Status Code 500>>
** <<Status Code 502>>
** <<Status Code 503>>
** <<Status Code 504>>
* <<Status Code 404, Resource Not Found>>
* <<Status Code 405, Session Integrity Failure>>
* <<Status Code 503, Application is in Maintenance>>
* <<Status Code 503, Application is Offline>>
* <<Status Code 504, SPGateway Timeout>>
* <<Status Code 504, Application Timeout - Backend>>
* <<Login Error>>
* <<Unexpected Appliance Behavior>>
* <<Multiple Application Certificate Errors>>
* <<Redirect Looping>>
* <<Invalid IDP API Key>>
* <<App Name is Out of Sync>>
* <<Site Can Not Be Reached/Displayed>>
* <<Setup/App Creation Freezes>>
* <<TLS Page Not Displaying>>
* <<Appendix - Troubleshooting Tools>>
** <<Ping>>
** <<NS Lookup>>
** <<Telnet>>
** <<NetCat>>

== How to Monitor Logs
//this isn't showing up in Atom, but it works fine on the live site MC 5/23/19
include::{frags}/frag-spgw-monitor-logs.adoc[]

== HTTP Status Codes

SPGateway and other applications return the following status codes to the browser during any event. They are also captured in the access log for troubleshooting issues.

include::{frags}/frag-http-status-codes.adoc[]

=== How Do I Find My Status Code?

The SPGateway presents status codes as shown below:

image::spgw-tbs-troubleshooting-guide-01.jpg[]

////
[NOTE]
====
* HTTP status codes visible in the browser could be returned from a backend application, which could be misleading. In case of any HTTP errors, all HTTP status codes returned by SPGateway are displayed as user friendly error messages on the page along with SPGateway branding in the header and footer sections (see the screenshot above for an example).
* The example screenshot below is an example of a generic error message, not a message generated by the SPGateway. This type of generic error message will look different for every application. If the page is not an SPGateway page, it indicates which HTTP status code is being returned by the application protected by SPGateway (see the example "Error 500" screenshot below for an example).
====
////

[NOTE]
====

* HTTP status codes visible in the browser could be returned from a backend application, which could be misleading. In case of any HTTP errors, all HTTP status codes returned by SPGateway are displayed as user friendly error messages on the page along with SPGateway branding in the header and footer sections (see the screenshot above for an example).
* The example screenshot below is an example of a generic error message, not a message generated by the SPGateway. This type of generic error message will look different for every application. If the page is not an SPGateway page, it indicates which HTTP status code is being returned by the application protected by SPGateway (see the example "Error 500" screenshot below for an example).

====

Some status codes are caused by a backend application error and need to be investigated on the application side.

image::spgw-tbs-troubleshooting-guide-02a.png[]

Steps to capture an HTTP status code:

////
NOTE: In some cases, and depending on the application or error, the end user may not see an SPGateway error screen, and a status code must be collected from the browser. Follow these steps to capture a status code using the browser developer tools.
////

NOTE: In some cases, and depending on the application or error, the end user may not see an SPGateway error screen, and a status code must be collected from the browser. Follow these steps to capture a status code using the browser developer tools.


. Open a new browser window.
. Right-click the page, and click *Inspect* to open Developer Tools.
. Click the *Network* tab.
. Enter the URL you want to test, and press Enter.
. Complete the login process if required.
. Capture the status code of the page in question. See the image below for more information.

image::spgw-tbs-troubleshooting-guide-02.jpg[]

////
NOTE: The steps shown above to open Developer Tools are applicable to Google Chrome. In IE, Developer Tools can be opened by pressing F12.
////

NOTE: The steps shown above to open Developer Tools are applicable to Google Chrome. In IE, Developer Tools can be opened by pressing F12.

== Tracking ID

In case of an internal server error, SPGateway generates a tracking ID that is displayed on the error page. This tracking ID can be used to identify the event and corresponding log messages from the log files while troubleshooting. +

If the error page has a tracking ID, you can click the *Tracking ID* button to copy the tracking ID and the associated error message provided in the log. This message contains important information that can help you troubleshoot the issue.

image::spgw-tbs-troubleshooting-guide-03.jpg[]

Log Statement::
+
----
SPGateway host:[<host URL>]referer:[<IDP SSO URL>]error:[Login Error] tracking ID:[6eff1f9ca3] details:[Requester/RequestDenied: Could not validate the following SAML AuthnRequest from partner Test App: ]
----

<<What Problem are You Experiencing?, Jump to top &#8593;>>

=== Status Code 400

==== Unknown Host Status

The requested host: '<Requested Hostname>' is not being served by this SPGateway.

Possible Cause:: The DNS record resolves to the SPGateway, and there is no service or application available on the SPGateway with the corresponding host name.
Log Statement::
+
----
Mar  7 15:26:26 localhost.localdomain icsDefault443Access <host URL> 192.168.1.4 - - [07/Mar/2018:15:26:26 -0600] "GET / HTTP/1.1" 400 1992 "-" "Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/64.0.3282.186 Safari/537.36" "-" 0.035 0.035 .
----
Fix/Validation Steps::
. Check that you are using the correct URL.
. Check that the Public Domain field in SPGateway application is correct.
. Check that your DNS or local hosts file correctly addresses the hostname and IP address.
. Check that your application is configured properly with the relevant hostname.

*Did the fix/validation steps solve your problem?* If not, please link:http://icsynergy.freshdesk.com[file a support ticket] in our Support Portal for additional assistance.

<<What Problem are You Experiencing?, Jump to top &#8593;>>

=== Status Code 403

==== Access Denied to Resource

Access to resource `<Requested Resource>` in application "Requested Applications" has been denied.

Possible Cause:: The SPGateway returns this status code when the policy engine denies access to a protected resource. You might receive this status code if there is a condition where certain access to a resource is intentionally prohibited.
Log Statement::
+
----
Mar  7 15:36:22 localhost spgwACCESS AUTHZ POLICY INFO USER_AUTHZ [SESSION_ID="_aa3b92617708c430ad74acbd6b1cf23f4809b48141" SUBJECT="<User login ID>" RESOURCE="/test" METHOD="GET" POLICY="test" POLICY_TYPE="PROTECTED_REGEX" DURATION="0" APP="<Application name / description>" APP_TYPE="SAMPLEIDPHEADER2015_APP" APP_DOMAIN="<App domain URL>" RESULT="DENY" REASON="Groups=(?!.*Everyone:) - SESSIONID=_aa3b92617708c430ad74acbd6b1cf23f4809b48141 RelayDomain=<Relay domain URL> static1=static1 secret=secretvalue spgw_username=<User ID> UserName=<User ID> spgw_username=<User ID> cloud:identity:domain=<IDP tenant subdomain> workEmail=<User work email attribute> cloud:identity:tenant=<IDP tenant subdomain> givenName=<User first name> familyName=<User last name> email=<User email> SourceAuthNType=urn:oasis:names:tc:SAML:2.0:ac:classes:PasswordProtectedTransport RemoteIP=192.168.1.4 USER_AGENT=Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/64.0.3282.186 Safari
/537.36 creationTime=1520458088124 maxInactiveInterval=3600000 maxActiveInterval=28800000 lastAccessedTime=1520458092027 " REMOTE_IP="<IP Address>" USER_AGENT="Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/64.0.3282.186 Safari/537.36"] deny access to resource
----
Fix/Validation Steps::
. Verify this is indeed an error and not an intentional 'denied resource'.
. Verify and fix the defined policy in the SPGateway application.
. Verify that the user is allowed access by the policy.
. link:http://icsynergy.freshdesk.com[Contact Support] if the application resource is still inaccessible.


*Did the fix/validation steps solve your problem?* If not, please link:http://icsynergy.freshdesk.com[file a support ticket] in our Support Portal for additional assistance.

<<What Problem are You Experiencing?, Jump to top &#8593;>>

=== Status Code 404

==== Resource Not Found

The page you are trying to access does not exist.

Possible Cause:: The SPGateway returns this status code when the requested resource is unavailable.
Log Statement::
+
----
Apr  5 03:59:57 spgw01 icsIcsgwAccess <SPGateway domain> <SPGateway IP address> - - [05/Apr/2018:03:59:57 -0500] "GET / HTTP/1.1" 404 1922 "-" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/65.0.3325.181 Safari/537.36" "<SPGateway IP address>" 0.019 0.019 .
----
Fix/Validation Steps::
. Check the URL to make sure it is correct, and ensure that the resource still exists and is pointed toward the correct location.
. If resource is inaccessible, contact Support.

*Did the fix/validation steps solve your problem?* If not, please link:http://icsynergy.freshdesk.com[file a support ticket] in our Support Portal for additional assistance.

<<What Problem are You Experiencing?, Jump to top &#8593;>>

=== Status Code 405

==== Access Denied

The SPGateway has detected an anomaly in user access to the `<Requested Application>`.

Possible Cause:: The SPGateway will return this status code when it detects a possible issue with session integrity to prevent sessions from being hijacked. This can also happen when a user switches networks with an active session in place.
Log Statement::
+
----
Apr  2 15:19:32  spgwACCESS AUTHZ SESSION WARN USER_SESSION [SESSION_ID="_0e53b206b5aa2d8b93cdf7f48c4c5ca51e2eeff494" SUBJECT="<User ID>" APP="IDP Sample Header App 1" APP_TYPE="SAMPLEIDPHEADER2015_APP" APP_DOMAIN="<App domain URL>" RESULT="DENY" REASON="SESSION_INTEGRITY_REMOTEIP_MISMATCH" REMOTE_IP="<Remote IP address>" USER_AGENT="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/65.0.3325.181 Safari/537.36"] SRF Request RemoteIP (http_x_real_ip): <User IP address> failed to match session RemoteIP: <Remote IP address>
Apr  2 15:19:32  IDPsampleheaderapp1 <App domain URL> <User IP address> - - [02/Apr/2018:15:19:32 -0500] "GET / HTTP/1.1" 405 2050 "<IDP SSO URL>" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/65.0.3325.181 Safari/537.36" "<User IP address>" 0.010 0.010 .
----
Fix/Validation Steps::
. Verify with the user if they changed networks during an active session with SPGateway.
. If step 1 is confirmed, the user must restart the browser and log in again to create a new session.

*Did the fix/validation steps solve your problem?* If not, please link:http://icsynergy.freshdesk.com[file a support ticket] in our Support Portal for additional assistance.

<<What Problem are You Experiencing?, Jump to top &#8593;>>

=== Status Code 413

==== Request Entity Too Large Code

The SPGateway will display error 413 if the file being uploaded is greater than 1MB.

Possible Causes:: By default, the SPGateway is set to allow file uploads that are less than 1MB in size.
Fix/Validation Steps::
. Use the developer tools to confirm that the HTTP status code being returned by the SPGateway is 413.
. To increase the file upload limit, click the *Applications* tab.
. Click the *Edit App* icon for the corresponding application.
. Open the *Advanced* dropdown menu within the application.
. Slide the *Maximum File Upload Size Adjuster* to an appropriate size.

*Did the fix/validation steps solve your problem?* If not, please link:http://icsynergy.freshdesk.com[file a support ticket] in our Support Portal for additional assistance.

<<What Problem are You Experiencing?, Jump to top &#8593;>>

=== Status Code 500

==== Internal Server Error

An unexpected server error has occurred. The error has been logged. Please contact your support service if you face this error message.

Possible Cause:: Error in an SPGateway component.
Log Statement::
+
----
Apr  2 22:53:10  IDPsampleheaderapp1 2018/04/02 22:53:10 [info] 26875#0: *3909 client closed connection while waiting for request, client: 192.168.10.20, server: 0.0.0.0:443
Apr  2 22:53:10  IDPsampleheaderapp1 <App domain URL> <IP address> - - [02/Apr/2018:22:53:10 -0500] "GET /GOPYX48z5/module.php/icsgw/as_login.php?AuthId=k3x6WX20E&ReturnTo=https://<App domain URL> HTTP/1.1" 302 2707 "<SPGateway domain URL>" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/65.0.3325.181 Safari/537.36" "-" 0.006 0.006 .
----
Fix/Validation Steps::
link:http://icsynergy.freshdesk.com[Contact Support] to investigate the issue.

*Did the fix/validation steps solve your problem?* If not, please link:http://icsynergy.freshdesk.com[file a support ticket] in our Support Portal for additional assistance.

<<What Problem are You Experiencing?, Jump to top &#8593;>>

=== Status Code 502

==== Application is Not Responding

The backend web application `<Requested Application>` is not receiving user requests from the SPGateway and not available for usage.

Possible Cause:: The SPGateway will return this error when it fails to connect to the backend application it is protecting.
Log Statement::
+
----
Apr  5 04:01:38 spgw01 icsadmin <SPGateway domain URL> <IP address> - - [05/Apr/2018:04:01:38 -0500] "GET / HTTP/1.1" 502 2130 "-" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/65.0.3325.181 Safari/537.36" "-" 0.006 0.000, 0.000 : 0.005 .
----
Fix/Validation Steps::
. Ensure the app is working and the protected URL specified in the SPGateway is reachable.
. Ensure the DNS record is resolvable.
. Ensure the backend application is reachable from the server that hosts the SPGateway appliance using the troubleshooting tools in the <<Appendix - Troubleshooting Tools, Appendix>>.
. If using a load balancing solution, individually verify if all or one of the SPGateway appliances are causing the issue.

*Did the fix/validation steps solve your problem?* If not, please link:http://icsynergy.freshdesk.com[file a support ticket] in our Support Portal for additional assistance.

<<What Problem are You Experiencing?, Jump to top &#8593;>>

=== Status Code 503

==== Application Not Activate

Application `<Requested Application>` has been disabled and is not available for usage.

////
NOTE: Any of these 503 status codes might display if an administrator has chosen to temporarily remove access to an application. Likewise, the application will also be disabled in IDP. Before editing any settings in the SPGateway Admin UI, confirm the application status with the application owner or appropriate manager.
////

NOTE: Any of these 503 status codes might display if an administrator has chosen to temporarily remove access to an application. Likewise, the application will also be disabled in IDP. Before editing any settings in the SPGateway Admin UI, confirm the application status with the application owner or appropriate manager.

Possible Cause:: The SPGateway will show this warning page when an application has been marked as inactive.
Log Statement::
+
----
Mar  7 16:56:39 localhost spgwACCESS AUTHZ POLICY INFO USER_AUTHZ [SESSION_ID="N/A" SUBJECT="" RESOURCE="/" METHOD="GET" POLICY="INACTIVE" POLICY_TYPE="NO_AUTH" DURATION="0" APP="IDP Sample Header App" APP_TYPE="SAMPLEIDPHEADER2015_APP" APP_DOMAIN="<App domain URL>" RESULT="ALLOW" REASON=" - N/A" REMOTE_IP="<Remote IP address>" USER_AGENT="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/64.0.3282.186 Safari/537.36"] allow access to resource
----
Fix/Validation Steps::
. Open the SPGateway Admin UI.
. Go to the *Applications* tab.
. Verify that the status of your application is set to *Inactive*.
. Edit the *Application*.
. Change the application status to *Application is Active*.

*Did the fix/validation steps solve your problem?* If not, please link:http://icsynergy.freshdesk.com[file a support ticket] in our Support Portal for additional assistance.

<<What Problem are You Experiencing?, Jump to top &#8593;>>

==== Application is in Maintenance

The application `<Requested Application>` is temporarily not available for usage.

Possible Cause:: The SPGateway will show this warning page when an application status has been changed to maintenance mode for any maintenance activity.
Log Statement::
+
----
Mar  7 16:58:23 localhost spgwACCESS AUTHZ POLICY INFO USER_AUTHZ [SESSION_ID="N/A" SUBJECT="" RESOURCE="/" METHOD="GET" POLICY="ACTIVE_MAINT" POLICY_TYPE="NO_AUTH" DURATION="0" APP="IDP Sample Header App" APP_TYPE="SAMPLEIDPHEADER2015_APP" APP_DOMAIN="<App domain URL>" RESULT="ALLOW" REASON=" - N/A" REMOTE_IP="<Remote IP address>" USER_AGENT="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/64.0.3282.186 Safari/537.36"] allow access to resource
----
Fix/Validation Steps::
. Open the SPGateway Admin UI.
. Go to the *Applications* tab.
. Verify that the status of your application is set to *Maintenance*.
. Ensure that maintenance on the application is complete and the backend application is available.
. Edit the application.
. Change the application status to *Application is Active* when the application maintenance is complete.

*Did the fix/validation steps solve your problem?* If not, please link:http://icsynergy.freshdesk.com[file a support ticket] in our Support Portal for additional assistance.

<<What Problem are You Experiencing?, Jump to top &#8593;>>

==== Application is Offline

The application `<Requested Application>` is not functioning correctly and has been taken offline. This outage has been logged.

Possible Cause:: The SPGateway shows this warning when it detects potential errors with an application configuration and marks it offline.
Log Statement::
+
----
Apr  2 15:02:33  spgwACCESS AUTHZ POLICY INFO USER_AUTHZ [SESSION_ID="N/A" SUBJECT="" RESOURCE="/favicon.ico" METHOD="GET" POLICY="ACTIVE_OFFLINE" POLICY_TYPE="NO_AUTH" DURATION="0" APP="IDP Sample Header App 1" APP_TYPE="SAMPLEIDPHEADER2015_APP" APP_DOMAIN="<App domain URL>" RESULT="ALLOW" REASON=" - N/A" REMOTE_IP="<Remote IP address>" USER_AGENT="Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:59.0) Gecko/20100101 Firefox/59.0"] allow access to resource
Apr  2 15:02:33  IDPsampleheaderapp1 <App domain URL> <IP address> - - [02/Apr/2018:15:02:33 -0500] "GET /favicon.ico HTTP/1.1" 503 2063 "-" "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:59.0) Gecko/20100101 Firefox/59.0" "-" 0.011 0.011 .
----
Fix/Validation Steps::
. Open the SPGateway Admin UI.
. Go to the *Applications* tab.
. Verify that the status of your application is set to *Offline*.
. Edit the application.
. Change the application status to *Application is Active* after fixing the application configuration error.

*Did the fix/validation steps solve your problem?* If not, please link:http://icsynergy.freshdesk.com[file a support ticket] in our Support Portal for additional assistance.

<<What Problem are You Experiencing?, Jump to top &#8593;>>

=== Status Code 504

==== SPGateway Timeout

The 504 Gateway Timeout is an Oracle EBS Integration timeout error.

Possible Cause:: The EBS registration is not working or has been erased from the instance. The application will not provide the GUID and the _USER_ORCLGUID_ header will not appear in the SPGateway Logs when debug is enabled.
Log Statement::
+
----
Apr  2 15:49:53  oracleaccessgatetest1 <App domain URL> <App IP address> - - [02/Apr/2018:15:49:53 -0500] "GET /accessgate/ssologin HTTP/1.1" 504 2050 "<IDP federation response>" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/65.0.3325.181 Safari/537.36" "-" 1.017 1.002 : 0.008 .
----
Fix/Validation Steps::
. If EBS is expected to take longer than 60 seconds, increase the *Backend Timeout duration* in the *Advanced* dropdown menu in *Application Settings*.
. Troubleshoot and fix the EBS application instance.

*Did the fix/validation steps solve your problem?* If not, please link:http://icsynergy.freshdesk.com[file a support ticket] in our Support Portal for additional assistance.

<<What Problem are You Experiencing?, Jump to top &#8593;>>

==== Application Timeout - Backend App

The backend web application `<Requested Application>` is not responding in a timely manner to user requests from the SPGateway and/or not available for usage.

Possible Cause:: The SPGateway returns this error when it times out when trying to connect to an internal application it is protecting.
Log Statement::
+
----
Mar  7 17:47:32 localhost.localdomain headerssoapp11 2018/03/07 17:47:32 [error] 6703#0: *4793 upstream timed out (110: Connection timed out) while connecting to upstream, client: <Client IP address>, server: <Server domain URL>, request: "GET / HTTP/1.1", upstream: "http://1.1.1.1:80/", host: "<Host URL>", referrer: "<SPGateway Admin UI URL>"
----
Fix/Validation Steps::
. Ensure the application is responding.
. Ensure that the application URL is reachable from the SPGateway.
. Ensure that the connection is not being blocked at any stage.
. Test the connectivity to the backend application from the SPGateway.
. If the application is expected to take longer than 60 seconds, increase the *Backend Timeout duration* in the *Advanced* dropdown menu in *Application Settings*.

*Did the fix/validation steps solve your problem?* If not, please link:http://icsynergy.freshdesk.com[file a support ticket] in our Support Portal for additional assistance.

<<What Problem are You Experiencing?, Jump to top &#8593;>>

==== Application Render Failure

The application does not render if the backend application takes longer than 60 seconds to respond.

Possible Cause:: The SPGateway is set to time out after 60 seconds when waiting for a response from the backend application.
Log Statement::
+
----
Mar  7 17:47:32 localhost.localdomain headerssoapp11 2018/03/07 17:47:32 [error] 6703#0: *4793 upstream timed out (110: Connection timed out) while connecting to upstream, client: <Client IP address>, server: <Server domain URL>, request: "GET / HTTP/1.1", upstream: "http://1.1.1.1:80/", host: "<Host domain URL>", referrer: "<SPGateway Admin UI URL>"
----
Fix/Validation Steps::
. Ensure the application is responding.
. Ensure that the application URL is reachable from the SPGateway.
. Ensure that the connection is not being blocked at any stage.
. Test the connectivity to the backend application from the SPGateway.
. If the application is expected to take longer than 60 seconds, increase the *Backend Timeout duration* in the *Advanced* dropdown menu in *Application Settings*.

*Did the fix/validation steps solve your problem?* If not, please link:http://icsynergy.freshdesk.com[file a support ticket] in our Support Portal for additional assistance.

<<What Problem are You Experiencing?, Jump to top &#8593;>>

==== Application Timeout - Internal App

The backend web application `<Requested Application>` is not receiving user requests from the SPGateway and not available for usage.

Possible Cause:: The SPGateway returns this error when it times out while trying to connect to an internal application it is protecting.
Log Statement::
+
----
Mar  7 17:47:32 localhost.localdomain headerssoapp11 2018/03/07 17:47:32 [error] 6703#0: *4793 upstream timed out (110: Connection timed out) while connecting to upstream, client: <Client IP address>, server: <Server domain URL>, request: "GET / HTTP/1.1", upstream: "http://1.1.1.1:80/", host: "<Server domain URL>", referrer: "<SPGateway Admin UI URL>"
----
Fix/Validation Steps::
. Ensure the application is responding.
. Ensure that the application URL is reachable from the SPGateway.
. Ensure that the connection is not being blocked at any stage.
. Test the connectivity to the backend application from the SPGateway.
. If the application is expected to take longer than 60 seconds, increase the *Backend Timeout duration* in the *Advanced* dropdown menu in *Application Settings*.

*Did the fix/validation steps solve your problem?* If not, please link:http://icsynergy.freshdesk.com[file a support ticket] in our Support Portal for additional assistance.

<<What Problem are You Experiencing?, Jump to top &#8593;>>

== Login Error

Error being generated while logging in to an application.

////
NOTE: For login errors A *TRACKER_ID* will be assigned to each issue. Evidence of this can be seen in the log statements below.
////

NOTE: For login errors, a *TRACKER_ID* will be assigned to each issue. Evidence of this can be seen in the log statements below.

=== Time is not in sync.

Log Statement 1::
+
----
Apr  3 14:20:18 spgw01 spgwACCESS AUTHN SAML ERROR USER_AUTHN [TYPE="SAML_2_0" TRACKER_ID="882d8b2faf" SOURCE="<IDP SSO URL>" RESULT="FAIL" REASON="Invalid SAML Assertion" REMOTE_IP="<Remote IP address>" USER_AGENT="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/65.0.3325.181 Safari/537.36"] Requester/RequestDenied: Could not validate the following SAML AuthnRequest from partner <SPGateway Application Name>:
----
Fix/Validation Steps 1::
.	Log in to the SPGateway Admin UI.
.	Select the *Settings* tab.
.	Select *Advanced*.
.	Verify that the time is correct.
.	If the time is not correct, click *Resync*.
.	Click the refresh button to refresh system time and verify that it is current.
.	Test the application to determine if time is synchronized correctly.

Log Statement 2::
+
----
Apr  3 14:20:09 spgw01 spgwACCESS AUTHN SAML ERROR USER_AUTHN [TYPE="SAML_2_0" TRACKER_ID="882d8b2faf" SOURCE="<IDP SSO URL>" RESULT="FAIL" REASON="Invalid SAML Assertion" REMOTE_IP="<Remote IP address>" USER_AGENT="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/65.0.3325.181 Safari/537.36"] Received an assertion that is valid in the future. Check clock synchronization on IdP and SP.
----
Fix/Validation Steps 2::
.	Log in to the SPGateway Management Console.
.	Select the *Service* option, and then select the *NTP* option.
.	Choose the option to restart the NTP service.
.	Check the time in SPGateway web console.
.	Test the application.

Log Statement 3::
+
----
Apr  4 16:20:11 spgw01 spgwACCESS AUTHN SAML ERROR USER_AUTHN [TYPE="SAML_2_0" TRACKER_ID="d7703c136c" SOURCE="<IDP SSO URL>" RESULT="FAIL" REASON="Invalid SAML Assertion" REMOTE_IP="<Remote IP address>" USER_AGENT="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/65.0.3325.181 Safari/537.36"] Received an assertion that has expired. Check clock
----
Fix/Validation Steps 3::
.	Log in to the SPGateway Management Console.
.	Select the *Service* option, and then select the *NTP* option.
.	Select the *Set System Time* option.
.	Enter the time in `MON DD YYYY HH:MI:SS AM/PM` format.
.	Check the time in the SPGateway Admin UI and ensure it matches.
.	Test the application.

*Did the fix/validation steps solve your problem?* If not, please link:http://icsynergy.freshdesk.com[file a support ticket] in our Support Portal for additional assistance.

<<What Problem are You Experiencing?, Jump to top &#8593;>>

=== Browser does not trust the domain and does not posts SAML request

////
NOTE: This error can occur if a user keeps re-posting SAML assertions or if an error occurs in the process of accepting a self-signed SSL certificate.
////

NOTE: This error can occur if a user keeps re-posting SAML assertions or if an error occurs in the process of accepting a self-signed SSL certificate.

Log Statement::
+
----
Apr 04 14:19:44 ACCESS ERROR [3137b1cb3f] Caused by: Exception: Unable to find the current binding.
----
Fix/Validation Steps 1::
.	Open the returned certificate.
.	Check the validity of the certificate.
.	If the certificate is not valid, request a new certificate and update it in SPGateway using the Management Console.
.	Test the application.

Fix/Validation Steps 2::
.	Check if the URL of the application is trusted by the browser.
.	Add the URL of the application and all other SPGateway endpoints under the trusted zone settings in the browser.
.	Restart the browser.
.	Test the application.

*Did the fix/validation steps solve your problem?* If not, please link:http://icsynergy.freshdesk.com[file a support ticket] in our Support Portal for additional assistance.

<<What Problem are You Experiencing?, Jump to top &#8593;>>

== Unexpected Appliance Behavior

Possible Cause:: The browser cache can cause unexpected behaviors to occur in applications or the SPGateway.
Fix/Validation Steps::
. Clear the browser cache and retest.

*Did the fix/validation steps solve your problem?* If not, please link:http://icsynergy.freshdesk.com[file a support ticket] in our Support Portal for additional assistance.

<<What Problem are You Experiencing?, Jump to top &#8593;>>

== Multiple Application Certificate Errors

. When accessing an application, the browser is showing a certificate warning and takes the user to the application once the user clicks the proceed link.
. The application fails to open and user receives an SPGateway error screen.
. The application works normally if it is opened in the same browser session as used previously.

Possible Cause::
* This can happen when a browser does not trust the certificate. When the user clicks the proceed link, the browser does not post data to the SAML endpoint and the SAML assertion ends up failing.
* Or, when the application is opened again in the same browser session, the browser trusts the URL the next time because it has permission from the user to trust the URL, so it posts the correct data to the SAML endpoint.

*Fix/Validation Steps*

Temporary Fix - Local System Only::
. Add the SPGateway client certificate to the browser's trust store. Here is an example for Internet Explorer:
.. From the application page, open the certificate in the browser and export it to the local machine.
.. Open *Internet Options*.
.. Go to the *Content* tab.
.. Click *Certificates*.
.. In the pop up window, go to *Trusted Root Certification Authorities*.
.. Click *Import*.
.. Click *Next*.
.. Browse to the locally-saved certificate and select it.
.. Click *Next -> Next -> Finish*.
.. Click *Yes* in the security warning window to proceed with the installation.
.. Click *OK* and close all open windows.
.. Restart the machine if it still does not work.
.. Retest the login.

Permanent Fix - For All Systems::
. Procure a valid certificate.
. Update the certificate on the SPGateway appliance.
. Update the certificate on the load balancer if it is presenting the certificate.

*Did the fix/validation steps solve your problem?* If not, please link:http://icsynergy.freshdesk.com[file a support ticket] in our Support Portal for additional assistance.

<<What Problem are You Experiencing?, Jump to top &#8593;>>

== Redirect Looping

Internet Explorer can experience opening/closing of tabs or redirecting in a loop.

Possible Cause 1:: The browser does not trust the application or the SPGateway endpoints.
Fix/Validation Steps 1::
. Add the SPGateway hostname endpoint and application endpoint URLs to the *Trusted Zone* settings in IE settings.

Possible Cause 2:: If you are using a load-balanced solution, the browser resolves the SPGateway hostname to one node and the application public domain to another node.
Fix/Validation Steps 2::
. Verify that the load balancer enforces sticky sessions.
. <<Ping>> the *SPGateway Hostname* and the *Application Public Domain* to verify that they are resolving to different IP Addresses.
. Update the local hosts file or DNS entry to match the correct IP Addresses.

*Did the fix/validation steps solve your problem?* If not, please link:http://icsynergy.freshdesk.com[file a support ticket] in our Support Portal for additional assistance.

<<What Problem are You Experiencing?, Jump to top &#8593;>>

== Invalid IDP API Key

Possible Cause:: The IDP API token has been deleted from IDP.
Fix/Validation Steps::
. Create a new IDP API token in IDP under *Security -> API Menu*.
. Update the API Key in the SPGateway under *Setting -> Identity Providers*.

*Did the fix/validation steps solve your problem?* If not, please link:http://icsynergy.freshdesk.com[file a support ticket] in our Support Portal for additional assistance.

<<What Problem are You Experiencing?, Jump to top &#8593;>>

== App Name is Out of Sync

<App Name> is out of sync with IDP. Would you like to recreate this application is <IDP Org name>?

Possible Cause:: The application has been deleted from IDP.
Log Statement::
+
----
Apr  3 00:12:07  WEB_CONSOLE overloading gw app header names
Apr  3 00:12:07  WEB_CONSOLE Expecting statusCode:200 received:404 Error:{detail=The resource does not exist., schemas=[urn:ietf:params:scim:api:messages:2.0:Error, urn:ietf:params:scim:api:oracle:IDP:extension:messages:Error], status=404, urn:ietf:params:scim:api:oracle:IDP:extension:messages:Error={messageId=error.common.provider.resourceDoesNotExist}}
Apr  3 00:12:07  WEB_CONSOLE handling service exception: com.icsynergy.spgw.service.RemoteNotFoundException Error: com.icsynergy.spgw.domain.SPGWError(type:RemoteNotFoundException, status:0, code:SPGW_REMOTE_NOT_FOUND, message:App: Header SSO App testa is not found in in IDP: your_idp_com, developerMessage:Check that valid IDP app UUID: 1c22cdd2d7b2472ba35422897eaddfeb exists, errors:[:], context:com.icsynergy.spgw.domain.Application(settings:[cookieDomain:oracle.com, debug:false, deeplinking:true, desc:This is our header site, groups:[6e2abf3f0fa84dfb9f4fb30afb6de9a4], handlers:[_401:IDP_REDIRECT, _403:SPGW_DEFAULT_PAGE, _405:SPGW_DEFAULT_PAGE, _503_active_maint:SPGW_DEFAULT_PAGE, _503_active_offline:SPGW_DEFAULT_PAGE, _503_inactive:SPGW_DEFAULT_PAGE, _error:SPGW_ERROR_PATH, _error_managed:false, _error_path:/spgwError, _login:NO_APP_LOGIN_PATH, _login_managed:false, _login_path:/spgwLogin, _logout:SPGW_LOGOUT_PATH, _logout_path:/spgwLogout], idp:<IDP login URL>, idp_type:IDP_IDP, label:Header SSO App testa, name:headerssoapptesta, privatedomain:header.internal.local, privateurl:http://header.internal.local, relaydomain:<App domain URL>, relayurl:https://<App domain URL>, session:[idle:3600, max:28800], shortName:LWQeEN4k1, spgw:gw.oracle.com, status:ACTIVE, type:HEADERWEB2015_APP, version:HEADERWEB2015_APP_20150507], application:[auth:AUTH_HEADER, enforcerelaystate:true, host_header:false, maxFileSize:1, proxyReadTimeout:60], policies:[[active:true, desc:Protect all application resources, name:root, resource:/, rule:PROTECTED]], headers:[[active:true, header:spgw_username, source:IDP, type:HEADER, value:spgw_username]]
Apr  3 00:18:50        com.icsynergy.spgw.service.RemoteNotFoundException null
----
Fix/Validation Steps::
. Ensure that the API key used to configure the SPGateway is still active. If not, continue with the following steps.
. Delete the existing application from SPGateway.
. Confirm that the application is deleted from IDP before re-creating the app.
. Add the application again in the SPGateway.
. Ensure that the application has been created in IDP.

*Did the fix/validation steps solve your problem?* If not, please link:http://icsynergy.freshdesk.com[file a support ticket] in our Support Portal for additional assistance.

<<What Problem are You Experiencing?, Jump to top &#8593;>>

== Site Can Not Be Reached/Displayed

Possible Cause:: This happens when the browser is unable to reach the site. The root cause can be: The Application/SPGateway service(s) is not running or DNS entry is missing.

Fix/Validation Steps::
. Restart the SPGateway service(s)/backend app if it is not responding.
. Add required DNS entry in DNS or local hosts file.

*Did the fix/validation steps solve your problem?* If not, please link:http://icsynergy.freshdesk.com[file a support ticket] in our Support Portal for additional assistance.

<<What Problem are You Experiencing?, Jump to top &#8593;>>

== Setup/App Creation Freezes

The progress indicator keeps spinning during initial setup or while creating an application in the SPGateway.

Possible Cause:: This happens when the SPGateway fails to reach the designated IDP.
Log Statement::
+
----
Mar  7 17:19:43 localhost.localdomain WEB_CONSOLE IOException occured validating IDP host :<IDP login URL>
----
Fix/Validation Steps::
. Verify that the SPGateway appliance is able to connect to IDP.
. Look for the component that is blocking the connection and allow the connection to IDP.
. Check the connectivity to the IDP from the SPGateway.
. Ensure that the *Client ID* and *Client Secret* values are correct.
. Validate the IDP configuration in SPGateway and save the settings.

*Did the fix/validation steps solve your problem?* If not, please link:http://icsynergy.freshdesk.com[file a support ticket] in our Support Portal for additional assistance.

<<What Problem are You Experiencing?, Jump to top &#8593;>>

== TLS Page Not Displaying

Possible Cause:: This happens when a browser's TLS security settings do not properly authenticate a secure connection with the SPGateway.
Log Statement::
+
----
Apr 16 10:55:41 test-spgw icsDefault443Error 2018/04/16 10:55:41 [crit] 18480#0: *3047 SSL_shutdown() failed (SSL: error:140E0197:SSL routines:SSL_shutdown:shutdown while in init) while SSL handshaking, client: <Client IP address>, server:0.0.0.0:443
----
Fix/Validation Steps::
. In Internet Explorer, click the *Settings* menu.
. Select *Internet Options*.
. Click the *Advanced* tab.
. Scroll until you see the *SSL/TLS* settings under the *Security* section.
. Ensure that IE uses: *SSL 3.0*, *TLS 1.0*, *TLS 1.1* and *TLS 1.2*.
. Click *Apply*.
. Click *OK*.

*Did the fix/validation steps solve your problem?* If not, please link:http://icsynergy.freshdesk.com[file a support ticket] in our Support Portal for additional assistance.

<<What Problem are You Experiencing?, Jump to top &#8593;>>

== Appendix - Troubleshooting Tools
These tools can be used to investigate and resolve issues that occur on the SPGateway, IDP, applications, the network, and in browsers.

=== Ping

_Ping_ is a computer network administration software utility used to test the reachability of a host on an Internet Protocol (IP) network. It measures the round-trip time for messages sent from the originating host to a destination computer that are echoed back to the source.

Usage::
`ping <destination>`

Sample output::

----
root@spgw~]# ping spgw
PING spgw(192.168.0.211) 56(84) bytes of data.
64 bytes from spgw(192.168.0.211): icmp_seq=1 ttl=64 time=0.033 ms
64 bytes from spgw(192.168.0.211): icmp_seq=2 ttl=64 time=0.035 ms
64 bytes from spgw(192.168.0.211): icmp_seq=3 ttl=64 time=0.047 ms
64 bytes from spgw(192.168.0.211): icmp_seq=4 ttl=64 time=0.047 ms
64 bytes from spgw(192.168.0.211): icmp_seq=5 ttl=64 time=0.048 ms
^C
--- spgwping statistics ---
5 packets transmitted, 5 received, 0% packet loss, time 4479ms
rtt min/avg/max/mdev = 0.033/0.042/0.048/0.006 ms
----


Error::

In there is no response from the target host, most implementations of ping display nothing, or periodically print notifications about timing out. Possible ping outputs indicating a problem include the following:

* `H`, `!N`, or `!P` — host, network, or protocol unreachable.
* `S` — source route failed.
* `T` — return time in milliseconds or 1/4 meters-second (normally in telephone meters per and in traffic control milli per second).
* `F` — fragmentation needed.
* `U` or `!W` — destination network/host unknown.
* `I` — source host is isolated.
* `A` — communication with destination network administratively prohibited.
* `Z` — communication with destination host administratively prohibited.
* `Q` — for this ToS, the destination network is unreachable.
* `X` — communication administratively prohibited.
* `V` — host precedence violation.
* `C` — precedence cutoff in effect.

In case of an error, the target host or an intermediate router sends back an ICMP error message, such as “host unreachable” or “TTL exceeded in transit.” In addition, these messages include the first eight bytes of the original message (in this case, the header of the ICMP echo request, including the quench value), so the ping utility can match responses to originating queries.

=== NS Lookup

_nslookup_ is a network administration command-line tool available for many computer operating systems for querying the Domain Name System (DNS) to obtain domain name, IP address mapping, or any other specific DNS records.

Usage::
`nslookup [-option] [name | -] [server]`

NOTE: Please see http://linux.die.net/man/1/nslookup[this page] for more details on available options.

Sample output::

----
[root@spgw~]# nslookup www.icsynergy.com
Server:         8.8.8.8
Address:        8.8.8.8#53


Non-authoritative answer:
Name:   www.icsynergy.com
Address: 69.195.124.173


Error:
Here is sample output when nslookup fails to find the DNS record:
[root@spgw~]# nslookup spgw
Server:         8.8.8.8
Address:        8.8.8.8#53


** server can't find spgw: NXDOMAIN
----

=== Telnet

The _telnet_ command is used for interactive communication with another host using the TELNET protocol. It begins in command mode where it prints a telnet command prompt (`telnet>`).

Usage::
`telnet <host> <port>`

Sample output of a successful connection::

----
[root@spgw~]# telnet spgw443
Trying 192.168.0.211...
Connected to spgw.
Escape character is '^]'.
^C
Connection closed by foreign host.`
----


Sample output of a failed connection::

----
[root@spgw~]# telnet spgw445
Trying 192.168.0.211...
telnet: connect to address 192.168.0.211: Connection refused
----

////
NOTE: In the example above, host *spgw* is listening on port 443, but not on port 445.
////

NOTE:
In the example above, host *spgw* is listening on port 443, but not on port 445.

If telnet is not available on Windows, it can be enabled using these steps:

1.  Click *Start -> Control Panel*.
2.  Click *Programs and Features*.
3.  Click *Turn Windows features on or off*.
4.  In the *Windows Features* dialog box, select the *Telnet Client* option.
5.  Click *OK*. The system installs the appropriate files. This will take a few seconds to a minute to complete.


=== NetCat

The _nc_ (or netcat) utility is used for many tasks involving TCP, UDP, or UNIX-domain sockets. It can open TCP connections, send UDP packets, listen on arbitrary TCP and UDP ports, do port scanning, and deal with both IPv4 and IPv6. Unlike telnet, nc scripts nicely and separates error messages into standard errors instead of sending them to standard output like telnet does.

Usage:: `nc [options] <host> <port>`

Example::
Similar to telnet, nc can also be used to validate whether a host is listening on a specified port. Here are sample outputs of successful and failed connections:

Successful connection::

----
[root@spgw~]# nc -v -z -w 1 spgw443
Connection to spgw443 port [tcp/https] succeeded!
----


Failed connection::

----
[root@spgw~]# nc -v -z -w 1 spgw445
nc: connect to spgwport 445 (tcp) failed: Connection refused
----

////
NOTE: nc is only available on Unix, Linux, and Mac operating systems.
////

NOTE: nc is only available on Unix, Linux, and Mac operating systems.


=== SPGateway Sample Header Application

The sample header application is bundled with SPGateway and can be used to validate the state of the environment and identify issues. The tests below can be performed using the sample header application to identify the root cause of some issues.

[width="100%",cols="34%,33%,33%",options="header",]
|===
|No. |Component to Validate |Validation Steps
|1 |Connectivity with IDP a|
1.  Add/Edit an application in SPGateway.
2.  SPGateway will fail to create/save the application if it fails to connect to IDP.

|2 |IDP API token a|
1.  Add/Edit an application in SPGateway.
2.  SPGateway will report an error if the IDP API key is not active.

|3 |IDP attributes a|
1.  Add/Edit the sample header app in SPGateway.
2.  Add the required attribute in the *Attributes* tab, and pass it to the header.
3.  Open the sample header app and validate the value of the attribute.

|4 |SPGateway a|
1.  Open the sample header application.
2.  This should redirect you to IDP for authentication (if IDP session does not exist and policy is set to protect the app).
3.  Any discrepancy in application flow points to an issue in the environment.

|5 |Application in IDP a|
This can be tested in 2 different ways. +

Application chiclet in IDP:

1.  Log in to IDP.
2.  Click the application chiclet.
3.  This should redirect you to the application. If it does not, there is an issue in the environment.

Application URL in SPGateway:

1.  Log in to the SPGateway Admin UI.
2.  Go to the *Applications* tab.
3.  Right-click the Goto app button.
4.  Click *Copy link address* if using Chrome or Firefox, *Copy Link* if using Safari, or *Copy shortcut* if using Internet Explorer.
5.  Paste the URL in the address bar, and press Enter.
6.  This should take you to IDP for authentication before proceeding to the application. If you are not directed to the application after authentication, there is an issue with the environment.
|6 |Application in SPGateway a|
1.  Open the public URL configured in SPGateway Admin UI for the application in a browser window.
2.  This should take you to IDP for authentication before proceeding to the application. If you are not directed to the application after authentication, there is an issue with the environment.

|===
