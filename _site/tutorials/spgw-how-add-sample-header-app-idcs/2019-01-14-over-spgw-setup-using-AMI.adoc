= Configure SPGW using AMI
:page-layout: post
:page-category: Overview

This document covers the steps to start and configure SPGateway using AMI.

//images are not showing up in the asciidoc preview in Atom, but they look fine on the live site MC 5-22-19

== Create Image
. Log in to AWS, and click *EC2*.
+
image::spgw-setup-using-AMI-over-01.png[]
+
. Click *Launch Instance*.
+
image::spgw-setup-using-AMI-over-02.png[]
+
. Select *My AMIs*.
+
image::spgw-setup-using-AMI-over-03.png[]
+
. Search for the AMI that was shared, and click *Select*.
+
image::spgw-setup-using-AMI-over-04.png[]
+
. Select the size of the image based on the requirements, and click *Next: Configure Instance Details*.
+
TIP: We recommend the size t2.medium.

+
image::spgw-setup-using-AMI-over-05.png[]
+
. On the next page, select the network configuration.
+
TIP: We recommend ELB or at least a static IP.
+
image::spgw-setup-using-AMI-over-06.png[]
+

. Select your storage size and volume type, and click *Next: Add Tags*.
+
TIP: We recommend a size of 40GB.
+

image::spgw-setup-using-AMI-over-07.png[]
+
. Tag the instance, and click *Configure Security Group*. Adding a Node tag to identify nodes in the HA environment is also recommended.
+
image::spgw-setup-using-AMI-over-08.png[]
+
. Add rules to allow HTTPS from anywhere, remove the rule for SSH, and click *Review and Launch*.
+
image::spgw-setup-using-AMI-over-09.png[]
+
. Click *Launch*.
+
image::spgw-setup-using-AMI-over-10.png[]
+
. On the next page, you will be prompted to choose an existing keypair or create a new keypair and download it. Select one of the options and follow the on-screen directions.
+
NOTE: A keypair is required for AWS. The key you use in this step cannot be used in the future because SPGateway overwrites it.

+
Once you are finished, click *Launch Instances*.
+
image::spgw-setup-using-AMI-over-11.png[]
+
. Go back to *EC2 -> Instances*. You should see the new instance in the list. Wait for the status to change to _running_.
. Click the instance name. This will display the public IP of the instance, which you should copy to your clipboard or a text file for later.
+
image::spgw-setup-using-AMI-over-12.png[]

// this section exists as the Configure SPGateway section of spgw-how-setup-using-ovf

== Configure SPGateway

include::{docdir}/./fragments/frag-set-up-spgateway-ovf.adoc[]


//replace following section with frag-config-api-okta - cmc
== Generate API Token in Okta

include::{docdir}/./fragments/frag-config-api-okta.adoc[]


== Add and Test Sample Header Application
//
Sample header applications are bundled with SPGateway to test the functionality of SPGateway, and to integrate with IDPs. Follow these steps to add and test a sample header application.

//need to determine if we can link to the other topic with the same workflow or if we can share common sections between them using include:: calls

//add sample header application seemed to be the same, so I created a fragment and replaced to the step where you select the name of the header. Testing seemed to be different. - cmc

=== Add Sample Header Application

include::{docdir}/./fragments/frag-add-and-test-sample-header-app.adoc[]

. Scroll down and select *SPGW Sample Header*.
+
image::spgw-setup-using-AMI-over-33.png[]
+
. Scroll back up to the top of the page and click *Create*.
+
image::spgw-setup-using-AMI-over-34.png[]
+
. Copy the public domain displayed on the page. The public URL needs to be added in DNS as a CNAME. If this entry is not available in DNS, it can be added in the local host file to test.
+
Edit your hosts file if DNS is not updated, and add another entry with the public domain captured for the sample header application. Your host file should now look like this:
+
----
xxx.xxx.xxx.xxx gw.icsynergy.info gw.icsynergy.info
xxx.xxx.xxx.xxx header.icsynergy.info
----
+
image::spgw-setup-using-AMI-over-35.png[]
+
. Scroll down to the *Groups* field. Type in the group that needs to be assigned to this application, and select the group name from the dropdown menu. Members of the selected group will be able to view and access the application in Okta.
+
image::spgw-setup-using-AMI-over-36.png[]
+
. Scroll back up and click *Next*.
+
image::spgw-setup-using-AMI-over-37.png[]
+
. Click *Next* on the *Attributes* page.
+
image::spgw-setup-using-AMI-over-38.png[]
+
. Click *Done* on the *Policies* page.
+
image::spgw-setup-using-AMI-over-39.png[]
+
. The new sample header application will be listed on the *Applications* page.
+
image::spgw-setup-using-AMI-over-40.png[]

=== Test Sample Header Application
. On the *Applications* page, click the *Go To App* button.
+
image::spgw-setup-using-AMI-over-41.png[]
+
. Your browser will now open a new tab and take you to the Okta login page. Enter your credentials and sign in.
. Proceed past any security exceptions raised by your browser.
. The new sample header application will now appear with a list of header attributes received.
+
image::spgw-setup-using-AMI-over-42.png[]
