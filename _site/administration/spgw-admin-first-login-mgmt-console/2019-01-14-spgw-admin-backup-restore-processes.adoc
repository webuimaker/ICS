= SPGateway Backup and Restore Processes
:page-layout: post
:page-category: Administration

Backing up your SPGateway appliances and configurations is a proactive safeguard against data loss, down-time, and other unwanted negative impacts to your business. There are two primary methods of backing up SPGateway appliances and configurations, and we recommend implementing both.

== Image-based backup and restore process recommendations


=== Image-based Backups


Image-based backups are created using the built-in snapshot functionality found in VMware, VirtualBox, ESXi, and other hypervisor products. The benefit of image-based backups is that the entire SPGateway appliance and virtual machine is backed up. Here are some details about creating snapshots using some of the most common industry hypervisor solutions.

* VMware / ESXi
* VirtualBox
* Microsoft Azure
* Amazon Web Services (AWS)


=== Image-based Restore

If you need to revert to a previous state, you can restore to another SPGateway machine snapshot from the hypervisor interface.

[NOTE]
====
* We recommend creating a machine snapshot prior to updating an SPGateway appliance.
* We do not recommend that users restore SPGateway snapshots as it can cause:
** Loss of recent backup files that SPGateway automatically creates.
** Loss of recent changes in the SPGateway appliance; additionally, the application configurations hosted on SPGateway may become out of sync with the identity provider.
* If the SPGateway is part of a cluster, ensure you revert all nodes to the same snapshot.
====


== Internal SPGateway backup and restore process

=== Backups

* On a nightly basis (at 12:00AM UTC -5), the SPGateway appliance automatically creates a backup of the current SPGateway state. This includes all identity provider and application configurations, custom configurations, and other appliance-specific data.
* The SPGateway internal backups are stored locally and encrypted using a private key.
* The default process retains backup archives for two months; archives older than two months are deleted to manage available disk space.
* Every node in an SPGateway cluster is synchronized to use the same configuration. However, each node is responsible for creating an individual backup. Backup archives created on individual nodes are not synchronized.

NOTE: If you require the backup archives to be externalized, please https://icsynergy.freshdesk.com[create a Freshdesk service ticket].

=== Restore

* An SPGateway administrator or user must https://icsynergy.freshdesk.com[create a service ticket] for the ICSynergy Support team to restore an SPGateway appliance to a previous state using the internal backup archives.
* If an application configuration was modified after a recent backup archive, the application may not be in sync with the identity provider after the restore process. In this case, you must update the application configuration after the restore process is complete.
* The functionality to restore an SPGateway backup archive is not available to SPGateway administrators or users. A service ticket must be created in order to restore an SPGateway backup archive.

NOTE: If a restore process is requested for a clustered environment, *all* nodes must be reverted to the same backup point.
